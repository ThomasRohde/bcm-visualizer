<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Hierarchical Diagram Generator Example</title>
<style>
body {
  font-family: Arial, sans-serif;
  margin: 0;
  display: flex;
  height: 100vh;
}
#sidebar {
  width: 260px;
  background: #f4f4f4;
  padding: 15px;
  overflow-y: auto;
  border-right: 1px solid #ccc;
}
#sidebar h2 {
  font-size: 16px;
  margin-top: 0;
}
.control {
  margin-bottom: 15px;
}
.control label {
  font-size: 13px;
  margin-bottom: 5px;
  display: block;
}
.control input[type=range] {
  width: 100%;
}
.control input[type=color],
.control select {
  width: 100%;
  padding: 3px;
}
#diagram-container {
  flex-grow: 1;
  overflow: auto;
  padding: 10px;
}
</style>
</head>
<body>
<div id="sidebar">
  <h2>Options</h2>
  <div class="control">
    <label>Layout Type</label>
    <select id="layoutType">
      <option value="grid">Standard Grid</option>
      <option value="aspectRatio">Aspect Ratio Optimized</option>
    </select>
  </div>
  <div class="control" id="columnsControl">
    <label>Columns <span id="columnsVal">2</span></label>
    <input type="range" id="columns" min="1" max="10" value="2" />
  </div>
  <div class="control" id="aspectRatioControl" style="display: none;">
    <label>Target Aspect Ratio <span id="aspectRatioVal">1.78</span></label>
    <input type="range" id="aspectRatio" min="0.5" max="3" step="0.1" value="1.78" />
  </div>
  <div class="control">
    <label>Padding <span id="paddingVal">12</span></label>
    <input type="range" id="padding" min="0" max="50" value="12" />
  </div>
  <div class="control">
    <label>Spacing <span id="spacingVal">8</span></label>
    <input type="range" id="spacing" min="0" max="50" value="8" />
  </div>
  <div class="control">
    <label>Min Node Width <span id="minNodeWidthVal">100</span></label>
    <input type="range" id="minNodeWidth" min="50" max="300" value="100" />
  </div>
  <div class="control">
    <label>Min Node Height <span id="minNodeHeightVal">60</span></label>
    <input type="range" id="minNodeHeight" min="30" max="200" value="60" />
  </div>
  <div class="control">
    <label>Font Size <span id="fontSizeVal">14</span></label>
    <input type="range" id="fontSize" min="8" max="36" value="14" />
  </div>
  <div class="control">
    <label>Border Radius <span id="borderRadiusVal">5</span></label>
    <input type="range" id="borderRadius" min="0" max="20" value="5" />
  </div>
  <div class="control">
    <label>Border Width <span id="borderWidthVal">1</span></label>
    <input type="range" id="borderWidth" min="0" max="5" value="1" />
  </div>
  <div class="control">
    <label>Border Color</label>
    <input type="color" id="borderColor" value="#888888" />
  </div>
  <div class="control">
    <label>Color by Level</label>
    <select id="colorByLevel">
      <option value="true" selected>Yes</option>
      <option value="false">No</option>
    </select>
  </div>
  <div class="control">
    <label>Root Color</label>
    <input type="color" id="color0" value="#f8f8f8" />
  </div>
  <div class="control">
    <label>Level 1 Color</label>
    <input type="color" id="color1" value="#d0e8f2" />
  </div>
  <div class="control">
    <label>Level 2 Color</label>
    <input type="color" id="color2" value="#e6f5d0" />
  </div>
  <div class="control">
    <label>Level 3 Color</label>
    <input type="color" id="color3" value="#f9e2d2" />
  </div>
  <div class="control">
    <label>Leaf Color</label>
    <input type="color" id="colorLeaf" value="#ffe6e6" />
  </div>
  <div class="control">
    <label>Leaf Node Width <span id="leafNodeWidthVal">120</span></label>
    <input type="range" id="leafNodeWidth" min="50" max="300" value="120" />
  </div>
  <div class="control">
    <label><input type="checkbox" id="fixedLeafWidthToggle" checked /> Fixed Leaf Width</label>
  </div>
</div>
<div id="diagram-container"></div>
<script src="https://cdn.jsdelivr.net/npm/@svgdotjs/svg.js@3.1.2/dist/svg.min.js"></script>
<script src="../dist/browser/diagram-generator.umd.js"></script>
<script>
const data = [
  { id: "channels", name: "Channels", parent: null },
  { id: "digital-self-service", name: "Digital Self-Service Channels", parent: "channels" },
  { id: "web-mobile", name: "Web & Mobile Banking", parent: "digital-self-service" },
  { id: "external-info", name: "External Information Exchange", parent: "digital-self-service" },
  { id: "open-banking", name: "Open Banking", parent: "digital-self-service" },
  { id: "homepages", name: "Homepages", parent: "digital-self-service" },
  { id: "communication", name: "Communication Channels", parent: "channels" },
  { id: "chat", name: "Chat", parent: "communication" },
  { id: "physical-mail", name: "Physical Mail", parent: "communication" },
  { id: "online-meetings", name: "Online Meetings", parent: "communication" },
  { id: "electronic-mail", name: "Electronic Mail", parent: "communication" },
  { id: "sms", name: "SMS", parent: "communication" },
  { id: "human", name: "Human Channels", parent: "channels" },
  { id: "contact-centres", name: "Contact Centres", parent: "human" },
  { id: "help-desk", name: "Help Desk", parent: "human" },
  { id: "branch-services", name: "Branch Services", parent: "human" },
  { id: "atms", name: "ATMs", parent: "channels" }
];

async function renderDiagram() {
  const container = document.getElementById('diagram-container');
  container.innerHTML = '';
  const fixedLeafWidthEnabled = document.getElementById('fixedLeafWidthToggle').checked;
  const leafNodeWidthValue = parseInt(document.getElementById('leafNodeWidth').value, 10);
  const layoutType = document.getElementById('layoutType').value;

  const layoutOptions = {
    padding: parseInt(document.getElementById('padding').value, 10),
    spacing: parseInt(document.getElementById('spacing').value, 10),
    layoutType: layoutType, // Add explicit layoutType property
    minNodeWidth: parseInt(document.getElementById('minNodeWidth').value, 10),
    minNodeHeight: parseInt(document.getElementById('minNodeHeight').value, 10)
  };
  
  // Set additional layout options based on selected type
  if (layoutType === 'grid') {
    const columnsValue = parseInt(document.getElementById('columns').value, 10);
    layoutOptions.columns = columnsValue;
    console.log(`Using Grid Layout with ${columnsValue} columns`, layoutOptions);
    // We can keep this for backward compatibility, but it's not necessary with layoutType
    layoutOptions.targetAspectRatio = undefined;
  } else if (layoutType === 'aspectRatio') {
    const aspectRatioValue = parseFloat(document.getElementById('aspectRatio').value);
    layoutOptions.targetAspectRatio = aspectRatioValue;
    console.log(`Using Aspect Ratio Layout with target ratio ${aspectRatioValue}`, layoutOptions);
  }

  const options = {
    layout: layoutOptions,
    style: {
      fontFamily: 'Helvetica, Arial, sans-serif',
      fontSize: parseInt(document.getElementById('fontSize').value, 10),
      borderRadius: parseInt(document.getElementById('borderRadius').value, 10),
      borderWidth: parseInt(document.getElementById('borderWidth').value, 10),
      borderColor: document.getElementById('borderColor').value,
      colorByLevel: document.getElementById('colorByLevel').value === 'true',
      colorPalette: {
        0: document.getElementById('color0').value,
        1: document.getElementById('color1').value,
        2: document.getElementById('color2').value,
        3: document.getElementById('color3').value,
        leaf: document.getElementById('colorLeaf').value
      },
      leafNodeWidth: fixedLeafWidthEnabled ? leafNodeWidthValue : undefined
    }
  };
  
  console.log('Rendering with options:', options);
  
  try {
    await DiagramGenerator.render(data, container, options);
  } catch (error) {
    console.error('Error rendering diagram:', error);
    container.innerHTML = `<p style='color:red'>Error: ${error.message}</p>`;
  }
}

const inputs = document.querySelectorAll('#sidebar input, #sidebar select');
inputs.forEach(input => {
  input.addEventListener('input', () => {
    const valSpan = document.getElementById(input.id + 'Val');
    if(valSpan) valSpan.textContent = input.value;
    renderDiagram();
  });
});

document.getElementById('layoutType').addEventListener('change', () => {
  const layoutType = document.getElementById('layoutType').value;
  document.getElementById('columnsControl').style.display = layoutType === 'grid' ? 'block' : 'none';
  document.getElementById('aspectRatioControl').style.display = layoutType === 'aspectRatio' ? 'block' : 'none';
  renderDiagram();
});

window.onload = renderDiagram;
</script>
</body>
</html>
